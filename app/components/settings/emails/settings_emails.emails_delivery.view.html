<section class='email_delivery_modal no-margin'>
  <md-toolbar>
    <div class='md-toolbar-tools'>
      <h2 md-truncate flex translate='settings.emails.emails_delivery.manage'></h2>
      <md-button class='md-icon-button'
                 ng-click='ctrl.closeModal();'
                 md-no-ink>
        <i class='mdi mdi-close m-r-sm i-24'></i>
      </md-button>
    </div>
  </md-toolbar>
  <md-content>
    <form name='create_emails_delivery_form'
          ng-submit='ctrl.submitForm(create_emails_delivery_form.$valid)'>
      <md-tabs class='email_delivery_tabs'
        flex
        md-selected='ctrl.tabIndex'
        md-no-pagination
        md-stretch-tabs
        md-dynamic-height>
        <md-tab>
          <md-tab-label>
            <div class='text-center l-h'><i class='mdi mdi-calendar'></i></div>
            <div class='text-center l-h'>
              <span>Periodic settings</span>
            </div>
          </md-tab-label>
          <md-tab-body>
            <div class='md-content-submit email_delivery_periodic wrapper'>
              <md-input-container class='md-block'>
                <label translate='type'></label>
                <md-select
                  ng-model='ctrl.form_data.recipient_condition'
                  ng-change='ctrl.recipientConditionChange()'
                >
                  <md-option
                    ng-value='name'
                    ng-repeat='name in ctrl.recipient_conditions'>
                    {{ 'settings.emails.emails_delivery.recipients.' + name | translate }}
                  </md-option>
                </md-select>
                <div class='md-errors-spacer'></div>
              </md-input-container>

              <div>
                <div class="row">
                  <div class="col-sm-3">
                    <div class="m-t-xs">Start sending on:</div>
                  </div>
                  <div class="col-sm-9">
                    <md-radio-group class="m-t-sm" ng-model="ctrl.form_data.start_sending_at_type">
                      <md-radio-button
                        ng-if="
                          ctrl.form_data.recipient_condition != 'birthday' &&
                          ctrl.form_data.recipient_condition != 'reservation_label_wedding' &&
                          ctrl.form_data.recipient_condition != 'reservation_label_promotion' &&
                          ctrl.form_data.recipient_condition != 'reservation_label_party' &&
                          ctrl.form_data.recipient_condition != 'reservation_label_drinks' &&
                          ctrl.form_data.recipient_condition != 'reservation_label_condolence' &&
                          ctrl.form_data.recipient_condition != 'reservation_label_company_outing'
                        "
                        value='date'
                        class='inline md-success'>
                        Date
                      </md-radio-button>
                      <md-radio-button
                        ng-if="
                          ctrl.form_data.recipient_condition != 'all' &&
                          ctrl.form_data.recipient_condition != 'newsletter_subscribers'
                        "
                        value='date_from_details'
                        class='inline md-success'
                      >
                        Date from details
                      </md-radio-button>
                    </md-radio-group>
                  </div>
                </div>

                <div class="row" ng-if="
                  ctrl.form_data.start_sending_at_type == 'date' &&
                  ctrl.form_data.recipient_condition != 'birthday' &&
                  ctrl.form_data.recipient_condition != 'reservation_label_wedding' &&
                  ctrl.form_data.recipient_condition != 'reservation_label_promotion' &&
                  ctrl.form_data.recipient_condition != 'reservation_label_party' &&
                  ctrl.form_data.recipient_condition != 'reservation_label_drinks' &&
                  ctrl.form_data.recipient_condition != 'reservation_label_condolence' &&
                  ctrl.form_data.recipient_condition != 'reservation_label_company_outing'
                ">
                  <div class="col-sm-6" style="width:195px">
                    <md-input-container class='md-block'>
                      <label translate='date'></label>
                      <md-datepicker ng-model='ctrl.form_data.start_sending_at_date'></md-datepicker>
                    </md-input-container>
                  </div>
                  <div
                    class="col-sm-6" 
                    style="width:150px">
                    <md-input-container class='md-block m-b-md'>
                      <label translate='time'></label>
                      <md-icon><i class='mdi mdi-clock i-20' /></md-icon>
                      <md-select ng-model='ctrl.form_data.start_sending_at_hour'>
                        <md-option ng-value='item'
                                 ng-repeat='item in ctrl.hours'>{{ item }}</md-option>
                      </md-select>
                    </md-input-container>
                  </div>
                </div>

                <div
                  ng-if="
                    (ctrl.form_data.recipient_condition != 'all' ||
                    ctrl.form_data.recipient_condition != 'newsletter_subscribers') &&
                    ctrl.form_data.start_sending_at_type == 'date_from_details'
                  ">
                  <div class="row">
                    <div class="col-sm-3" style="width:100px">
                      <div class="m-t-lg">Send email</div>
                    </div>
                    <div class="col-sm-3" style="width:100px">
                      <md-input-container class='md-block m-b-md'>
                        <md-select ng-model='ctrl.form_data.start_sending_at_date_from_details_days'>
                          <md-option ng-value='item'
                                   ng-repeat='item in ctrl.days'>{{ item }}</md-option>
                        </md-select>
                      </md-input-container>
                    </div>
                    <div class="col-sm-2" style="width:50px">
                      <div class="m-t-lg">days</div>
                    </div>
                    <div class="col-sm-3" style="width:150px">
                      <md-input-container class='md-block m-b-md'>
                        <md-select ng-model='ctrl.form_data.start_sending_at_date_from_details_period'>
                          <md-option ng-value='item'
                                   ng-repeat='item in ctrl.start_sending_at_date_from_details_period_collection'>{{ item }}</md-option>
                        </md-select>
                      </md-input-container>
                    </div>
                    <div class="col-sm-1" style="width:250px">
                      <div class="m-t-lg">
                        date from
                        <b ng-if="ctrl.form_data.recipient_condition === 'birthday'">Birthday</b>
                        <b ng-if="ctrl.form_data.recipient_condition === 'reservation_label_wedding'">Last wedding reservation</b>
                        <b ng-if="ctrl.form_data.recipient_condition === 'reservation_label_promotion'">Last promotion reservation</b>
                        <b ng-if="ctrl.form_data.recipient_condition === 'reservation_label_party'">Last party reservation</b>
                        <b ng-if="ctrl.form_data.recipient_condition === 'reservation_label_drinks'">Last drinks reservation</b>
                        <b ng-if="ctrl.form_data.recipient_condition === 'reservation_label_condolence'">Last condolence reservation</b>
                        <b ng-if="ctrl.form_data.recipient_condition === 'reservation_label_company_outing'">Last company outing reservation</b>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div ng-if="
                ctrl.form_data.recipient_condition != 'birthday' &&
                ctrl.form_data.recipient_condition != 'reservation_label_wedding' &&
                ctrl.form_data.recipient_condition != 'reservation_label_promotion' &&
                ctrl.form_data.recipient_condition != 'reservation_label_party' &&
                ctrl.form_data.recipient_condition != 'reservation_label_drinks' &&
                ctrl.form_data.recipient_condition != 'reservation_label_condolence' &&
                ctrl.form_data.recipient_condition != 'reservation_label_company_outing'
              ">
                <md-radio-group class="m-t-sm" ng-model="ctrl.form_data.sending_type">
                  <md-radio-button value='periodically' class='inline md-success'>
                    Send periodically
                  </md-radio-button>
                  <md-radio-button value='by_sending_date' class='inline md-success'>
                    Send once based on sending date
                  </md-radio-button>
                </md-radio-group>

                <div ng-if="ctrl.form_data.sending_type == 'periodically'">
                  <div class="row">
                    <div class="col-sm-1" style="width:100px">
                      <div class="m-t-lg">Send every</div>
                    </div>
                    <div class="col-sm-4" style="width:150px">
                      <md-input-container class='md-block m-b-md'>
                        <md-select ng-model='ctrl.form_data.sending_type_periodically_number'>
                          <md-option ng-value='item'
                                   ng-repeat='item in ctrl.sending_type_periodically_number_collection'>{{ item }}</md-option>
                        </md-select>
                      </md-input-container>
                    </div>
                    <div class="col-sm-4" style="width:200px">
                      <md-input-container class='md-block m-b-md'>
                        <md-select
                          ng-model='ctrl.form_data.sending_type_periodically_period'
                          ng-change='ctrl.onChangeSendEveryPeriod()'
                        >
                          <md-option ng-value='item'
                                   ng-repeat='item in ctrl.sending_type_periodically_period_collection'>{{ item }}</md-option>
                        </md-select>
                      </md-input-container>
                    </div>
                  </div>
                </div>
              </div>
              <md-input-container class='md-block m-t-none'>
                <div class='m-r-md'>
                  <md-switch ng-model='ctrl.form_data.enabled'>Enabled</md-switch>
                </div>
              </md-input-container>
            </div>
            <button type='button'
              class='btn btn-lg bg-white text-success w-full no-top-radius md-content-button'
              ng-click='ctrl.tabIndex = 1'
              translate='next'></button>
          </md-tab-body>
        </md-tab>
        <md-tab>
          <md-tab-label>
            <div class='text-center l-h'><i class='mdi mdi-code-braces'></i></div>
            <div class='text-center l-h'>
              <span>Template settings</span>
            </div>
          </md-tab-label>
          <md-tab-body>
            <div class='md-content-submit email_delivery_template wrapper'>
              <!-- <md-input-container class='md-block'>
                <label translate='cron'></label>
                <input ng-change="ctrl.updateCronDescription()" ng-model='ctrl.form_data.cron' />
                <span>{{ ctrl.cronDescription }}</span>
              </md-input-container> -->


              <md-input-container class='md-block'>
                <label translate='title'></label>
                <input ng-model='ctrl.form_data.title' required />
              </md-input-container>
              <md-input-container class='md-block'>
                <label translate='content'></label>
                <textarea rows='10'
                          max-rows='12'
                          ng-model='ctrl.form_data.content'></textarea>
              </md-input-container>

              <div>
                <a
                target="_blank"
                ng-href='{{ctrl.editorUrl}}'
                md-ink-ripple
                class='md-button btn-success no-margin'
                translate='settings.emails.edit_email'></a>
              </div>
            </div>
            <button type='submit'
              ng-class="{ 'disabled': !create_emails_delivery_form.$valid || ctrl.is_submitting }"
              class='btn btn-lg btn-success text-success w-full no-top-radius md-content-button'
              translate='save'>
            </button>
          </md-tab-body>
        </md-tab>
      </md-tabs>
    </form>
  </md-content>
</section>